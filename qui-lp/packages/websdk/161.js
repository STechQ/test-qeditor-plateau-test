"use strict";(this.webpackChunkwebsdk=this.webpackChunkwebsdk||[]).push([[161],{22161:(t,i,o)=>{o.r(i),o.d(i,{PlateauIAM:()=>l});var n=o(64e3),e=o(62190),r=function(t,i,o,n){return new(o||(o=Promise))((function(e,r){function a(t){try{s(n.next(t))}catch(t){r(t)}}function l(t){try{s(n.throw(t))}catch(t){r(t)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(t){t(i)}))).then(a,l)}s((n=n.apply(t,i||[])).next())}))},a=function(t,i){var o,n,e,r,a={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(e=2&r[0]?n.return:r[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,r[1])).done)return e;switch(n=0,e&&(r=[2&r[0],e.value]),r[0]){case 0:case 1:e=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((e=(e=a.trys).length>0&&e[e.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!e||r[1]>e[0]&&r[1]<e[3])){a.label=r[1];break}if(6===r[0]&&a.label<e[1]){a.label=e[1],e=r;break}if(e&&a.label<e[2]){a.label=e[2],a.ops.push(r);break}e[2]&&a.ops.pop(),a.trys.pop();continue}r=i.call(t,a)}catch(t){r=[6,t],n=0}finally{o=e=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},l=function(){function t(){var t=this;this.refreshTime=6e3,this.updateTime=10,this.initOptions={url:"http://identity-provider.dev.rally.softtech/auth/",realm:"main",clientId:"ui-web-client",onLoad:"login-required",pkceMethod:"S256",identityProvider:"",locale:""},this.iamPlateau=void 0,this.getToken=function(){return null!=t.iamPlateau?t.iamPlateau.token:void 0},this.getInfo=function(){return null!=t.iamPlateau?t.iamPlateau.info:void 0}}return t.prototype.setOptions=function(t){try{if(null!=t.identityProvider)if("object"==typeof t.identityProvider){var i="",o=t.url.split("."),n=2;try{(n=parseInt(t.identityProvider.order))<=0&&(n=2)}catch(t){n=2}if("queryString"===t.identityProvider.type){var r=new URLSearchParams(window.location.search);null!=r.get("subdomain")&&(i=r.get("subdomain"),o[n-1]=i,this.initOptions.subdomain=i),null!=r.get("realm")&&(t.realm=r.get("realm"));var a=t.localeQueryStringKey||"ui_locales";this.initOptions.locale=r.get(a)||void 0}else"subdomain"===t.identityProvider.type&&(i=window.location.host.split(".")[0],o[n-1]=i);t.url=o.join(".")}else t.identityProvider.length>1&&(t.url=window.location.protocol+"//"+window.location.host.replace(t.identityProvider,"identity-provider")+"/auth");t.url&&(this.initOptions.url=t.url),t.realm&&(this.initOptions.realm=t.realm),t.clientId&&(this.initOptions.clientId=t.clientId),t.onLoad&&(this.initOptions.onLoad=t.onLoad),t.pkceMethod&&(this.initOptions.pkceMethod=t.pkceMethod),t.identityProvider&&(this.initOptions.identityProvider=t.identityProvider)}catch(t){e.Y.Log({logMessage:"Error on setting IAM options",logType:e.h.Error})}},t.prototype.isAuthenticated=function(){var t;if(null!=(null===(t=this.iamPlateau)||void 0===t?void 0:t.token))return!0},t.prototype.init=function(t){return r(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return this.keycloak=(0,n.Z)(this.initOptions),[4,this.keycloak.init({onLoad:this.initOptions.onLoad,pkceMethod:this.initOptions.pkceMethod,checkLoginIframe:!1})];case 1:return(i=o.sent())?[3,3]:[4,this.keycloak.login({locale:this.initOptions.locale})];case 2:return o.sent(),[2];case 3:return"boolean"==typeof i&&(i?this.constructIAMPlateau():window.location.reload(),t()),[2]}}))}))},t.prototype.constructIAMPlateau=function(){var t,i,o;null==this.iamPlateau?this.iamPlateau={token:null===(t=this.keycloak)||void 0===t?void 0:t.token,info:null===(i=this.keycloak)||void 0===i?void 0:i.tokenParsed}:this.iamPlateau.token=null===(o=this.keycloak)||void 0===o?void 0:o.token,window.location.search&&(document.cookie="queryParamsIAM="+window.location.search+";path=/;")},t.prototype.refreshPromise=function(){var t;return r(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:i=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(t=this.keycloak)||void 0===t?void 0:t.updateToken(this.updateTime)];case 2:return i=o.sent(),this.constructIAMPlateau(),[3,4];case 3:return o.sent(),window.location.href=window.location.protocol+"//"+window.location.host,[3,4];case 4:return[2,i]}}))}))},t.prototype.logout=function(){var t,i,o=window.location.protocol+"//"+window.location.host;"queryString"===this.initOptions.identityProvider.type&&(this.initOptions.realm&&(o=window.location.protocol+"//"+window.location.host+"?realm="+this.initOptions.realm),this.initOptions.subdomain&&(o=window.location.protocol+"//"+window.location.host+"?subdomain="+this.initOptions.subdomain),this.initOptions.realm&&this.initOptions.subdomain&&(o=window.location.protocol+"//"+window.location.host+"?realm="+this.initOptions.realm+"&subdomain="+this.initOptions.subdomain)),console.log("getredirectURL:"),console.log(o);var n={redirectUri:o},e={redirectUri:null===(t=this.keycloak)||void 0===t?void 0:t.createLogoutUrl(n)};null===(i=this.keycloak)||void 0===i||i.logout(e)},t.prototype.login=function(){return r(this,void 0,void 0,(function(){var t;return a(this,(function(i){switch(i.label){case 0:return t=function(){},[4,this.init(t)];case 1:return i.sent(),[2]}}))}))},t}()}}]);