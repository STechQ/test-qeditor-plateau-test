"use strict";(this.webpackChunkwebsdk=this.webpackChunkwebsdk||[]).push([[161],{22161:(t,e,i)=>{i.r(e),i.d(e,{PlateauIAM:()=>l});var o=i(64e3),n=i(62190),r=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))},s=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},a=["https://","http://"],l=function(){function t(){var t=this;this.refreshTime=6e3,this.updateTime=10,this.initOptions={url:"http://identity-provider.dev.rally.softtech/auth/",realm:"main",clientId:"ui-web-client",onLoad:"login-required",pkceMethod:"S256",identityProvider:"",locale:""},this.iamPlateau=void 0,this.getToken=function(){return null!=t.iamPlateau?t.iamPlateau.token:void 0},this.getInfo=function(){return null!=t.iamPlateau?t.iamPlateau.info:void 0}}return t.prototype.setOptions=function(t){try{var e=null==t?void 0:t.options;if(!e)throw new Error("iam in settings is missing options");if(null!=e.identityProvider)if("object"==typeof e.identityProvider){var i="",o=e.url.split("."),r=2;try{(r=parseInt(e.identityProvider.order))<=0&&(r=2)}catch(t){r=2}if("queryString"===e.identityProvider.type){var s=new URLSearchParams(window.location.search);null!=s.get("subdomain")&&(i=s.get("subdomain"),o[r-1]=i,this.initOptions.subdomain=i),null!=s.get("realm")&&(e.realm=s.get("realm"));var a=e.localeQueryStringKey||"ui_locales";this.initOptions.locale=s.get(a)||void 0}else"subdomain"===e.identityProvider.type&&(i=window.location.host.split(".")[0],o[r-1]=i);e.url=o.join(".")}else e.identityProvider.length>1&&(e.url=window.location.protocol+"//"+window.location.host.replace(e.identityProvider,"identity-provider")+"/auth");e.url&&(this.initOptions.url=e.url),e.realm&&(this.initOptions.realm=e.realm),e.clientId&&(this.initOptions.clientId=e.clientId),e.onLoad&&(this.initOptions.onLoad=e.onLoad),e.pkceMethod&&(this.initOptions.pkceMethod=e.pkceMethod),e.identityProvider&&(this.initOptions.identityProvider=e.identityProvider),e.redirectUri&&(this.initOptions.redirectUri=e.redirectUri),e.responseMode&&(this.initOptions.responseMode=e.responseMode)}catch(t){var l=t.message||"error has no message";n.Y.Log({logMessage:"Error on setting IAM options: "+l,logType:n.h.Error})}},t.prototype.isAuthenticated=function(){var t;if(null!=(null===(t=this.iamPlateau)||void 0===t?void 0:t.token))return!0},t.prototype.init=function(t){return r(this,void 0,void 0,(function(){var e,i,n,r,a;return s(this,(function(s){switch(s.label){case 0:return this.keycloak=(0,o.Z)(this.initOptions),e=this.getTokens(),i={onLoad:this.initOptions.onLoad,pkceMethod:this.initOptions.pkceMethod,checkLoginIframe:!1,responseMode:this.initOptions.responseMode},n={locale:this.initOptions.locale},e&&e.idToken&&e.refreshToken&&e.token&&(i.idToken=e.idToken,i.refreshToken=e.refreshToken,i.token=e.token),(r=this.setQueryOrFragment(new URL(window.location.href),this.initOptions.redirectUri))&&(n.redirectUri=r,i.redirectUri=r),[4,this.keycloak.init(i)];case 1:return(a=s.sent())?[3,3]:[4,this.keycloak.login(n)];case 2:return s.sent(),[2];case 3:return this.setTokens(),"boolean"==typeof a&&(a?this.constructIAMPlateau():window.location.reload(),t()),[2]}}))}))},t.prototype.pathJoin=function(t,e){return(t=t.endsWith("/")?t.substring(0,t.length-1):t)+"/"+(e.startsWith("/")?e.substring(1):e)},t.prototype.setQueryOrFragment=function(t,e){if(e){if(null!=a.find((function(t){return e.startsWith(t)})))return e;var i=new URL("http://a.com/"+e),o="/"==t.pathname?"":t.pathname,n="/"==i.pathname?"":i.pathname,r=o&&n?n.startsWith("//")?n.substring(1):this.pathJoin(o,n):o||n,s=t.search&&i.search?t.search+i.search.replace("?","&"):t.search||i.search,l=t.hash&&i.hash?t.hash+i.hash.replace("#","&"):t.hash||i.hash;return t.origin+r+s+l}},t.prototype.constructIAMPlateau=function(){var t,e,i;null==this.iamPlateau?this.iamPlateau={token:null===(t=this.keycloak)||void 0===t?void 0:t.token,info:null===(e=this.keycloak)||void 0===e?void 0:e.tokenParsed}:this.iamPlateau.token=null===(i=this.keycloak)||void 0===i?void 0:i.token,window.location.search&&(document.cookie="queryParamsIAM="+window.location.search+";path=/;")},t.prototype.getTokens=function(){var t,e,i,o,n,r;if(null===(i=null===(e=null===(t=this.settingsIAM)||void 0===t?void 0:t.iam)||void 0===e?void 0:e.options)||void 0===i?void 0:i.preserveTokens)return{idToken:null!==(o=sessionStorage.getItem("kcIdToken"))&&void 0!==o?o:void 0,refreshToken:null!==(n=sessionStorage.getItem("kcRefreshToken"))&&void 0!==n?n:void 0,token:null!==(r=sessionStorage.getItem("kcToken"))&&void 0!==r?r:void 0}},t.prototype.setTokens=function(){var t,e,i;this.keycloak&&(null===(i=null===(e=null===(t=this.settingsIAM)||void 0===t?void 0:t.iam)||void 0===e?void 0:e.options)||void 0===i?void 0:i.preserveTokens)&&this.keycloak.idToken&&this.keycloak.refreshToken&&this.keycloak.token&&(sessionStorage.setItem("kcIdToken",this.keycloak.idToken),sessionStorage.setItem("kcRefreshToken",this.keycloak.refreshToken),sessionStorage.setItem("kcToken",this.keycloak.token))},t.prototype.refreshPromise=function(){var t;return r(this,void 0,void 0,(function(){var e;return s(this,(function(i){switch(i.label){case 0:e=!1,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,null===(t=this.keycloak)||void 0===t?void 0:t.updateToken(this.updateTime)];case 2:return e=i.sent(),this.constructIAMPlateau(),[3,4];case 3:return i.sent(),window.location.href=window.location.protocol+"//"+window.location.host,[3,4];case 4:return[2,e]}}))}))},t.prototype.logout=function(){var t,e,i=window.location.protocol+"//"+window.location.host,o=[{key:"realm",value:this.initOptions.realm},{key:"subdomain",value:this.initOptions.subdomain},{key:"lang",value:this.initOptions.locale}];"queryString"===this.initOptions.identityProvider.type&&o.reduce((function(t,e,o){return e.value?i=i+(0===o?"?":"&")+e.key+"="+e.value:t}),""),console.log("getredirectURL:"),console.log(i);var n={redirectUri:i},r={redirectUri:null===(t=this.keycloak)||void 0===t?void 0:t.createLogoutUrl(n)};null===(e=this.keycloak)||void 0===e||e.logout(r)},t.prototype.login=function(){return r(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return t=function(){},[4,this.init(t)];case 1:return e.sent(),[2]}}))}))},t}()}}]);