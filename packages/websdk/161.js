"use strict";(this.webpackChunkwebsdk=this.webpackChunkwebsdk||[]).push([[161],{22161:(t,i,e)=>{e.r(i),e.d(i,{PlateauIAM:()=>l});var n=e(64e3),o=e(62190),r=function(t,i,e,n){return new(e||(e=Promise))((function(o,r){function a(t){try{s(n.next(t))}catch(t){r(t)}}function l(t){try{s(n.throw(t))}catch(t){r(t)}}function s(t){var i;t.done?o(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(a,l)}s((n=n.apply(t,i||[])).next())}))},a=function(t,i){var e,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=i.call(t,a)}catch(t){r=[6,t],n=0}finally{e=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},l=function(){function t(){var t=this;this.refreshTime=6e3,this.updateTime=10,this.initOptions={url:"http://identity-provider.dev.rally.softtech/auth/",realm:"main",clientId:"ui-web-client",onLoad:"login-required",pkceMethod:"S256",identityProvider:"",locale:""},this.iamPlateau=void 0,this.getToken=function(){return null!=t.iamPlateau?t.iamPlateau.token:void 0},this.getInfo=function(){return null!=t.iamPlateau?t.iamPlateau.info:void 0}}return t.prototype.setOptions=function(t){try{var i=null==t?void 0:t.options;if(!i)throw new Error("iam in settings is missing options");if(null!=i.identityProvider)if("object"==typeof i.identityProvider){var e="",n=i.url.split("."),r=2;try{(r=parseInt(i.identityProvider.order))<=0&&(r=2)}catch(t){r=2}if("queryString"===i.identityProvider.type){var a=new URLSearchParams(window.location.search);null!=a.get("subdomain")&&(e=a.get("subdomain"),n[r-1]=e,this.initOptions.subdomain=e),null!=a.get("realm")&&(i.realm=a.get("realm"));var l=i.localeQueryStringKey||"ui_locales";this.initOptions.locale=a.get(l)||void 0}else"subdomain"===i.identityProvider.type&&(e=window.location.host.split(".")[0],n[r-1]=e);i.url=n.join(".")}else i.identityProvider.length>1&&(i.url=window.location.protocol+"//"+window.location.host.replace(i.identityProvider,"identity-provider")+"/auth");i.url&&(this.initOptions.url=i.url),i.realm&&(this.initOptions.realm=i.realm),i.clientId&&(this.initOptions.clientId=i.clientId),i.onLoad&&(this.initOptions.onLoad=i.onLoad),i.pkceMethod&&(this.initOptions.pkceMethod=i.pkceMethod),i.identityProvider&&(this.initOptions.identityProvider=i.identityProvider)}catch(t){var s=t.message||"error has no message";o.Y.Log({logMessage:"Error on setting IAM options: "+s,logType:o.h.Error})}},t.prototype.isAuthenticated=function(){var t;if(null!=(null===(t=this.iamPlateau)||void 0===t?void 0:t.token))return!0},t.prototype.init=function(t){return r(this,void 0,void 0,(function(){var i;return a(this,(function(e){switch(e.label){case 0:return this.keycloak=(0,n.Z)(this.initOptions),[4,this.keycloak.init({onLoad:this.initOptions.onLoad,pkceMethod:this.initOptions.pkceMethod,checkLoginIframe:!1})];case 1:return(i=e.sent())?[3,3]:[4,this.keycloak.login({locale:this.initOptions.locale})];case 2:return e.sent(),[2];case 3:return"boolean"==typeof i&&(i?this.constructIAMPlateau():window.location.reload(),t()),[2]}}))}))},t.prototype.constructIAMPlateau=function(){var t,i,e;null==this.iamPlateau?this.iamPlateau={token:null===(t=this.keycloak)||void 0===t?void 0:t.token,info:null===(i=this.keycloak)||void 0===i?void 0:i.tokenParsed}:this.iamPlateau.token=null===(e=this.keycloak)||void 0===e?void 0:e.token,window.location.search&&(document.cookie="queryParamsIAM="+window.location.search+";path=/;")},t.prototype.refreshPromise=function(){var t;return r(this,void 0,void 0,(function(){var i;return a(this,(function(e){switch(e.label){case 0:i=!1,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,null===(t=this.keycloak)||void 0===t?void 0:t.updateToken(this.updateTime)];case 2:return i=e.sent(),this.constructIAMPlateau(),[3,4];case 3:return e.sent(),window.location.href=window.location.protocol+"//"+window.location.host,[3,4];case 4:return[2,i]}}))}))},t.prototype.logout=function(){var t,i,e=window.location.protocol+"//"+window.location.host,n=[{key:"realm",value:this.initOptions.realm},{key:"subdomain",value:this.initOptions.subdomain},{key:"lang",value:this.initOptions.locale}];"queryString"===this.initOptions.identityProvider.type&&n.reduce((function(t,i,n){return i.value?e=e+(0===n?"?":"&")+i.key+"="+i.value:t}),""),console.log("getredirectURL:"),console.log(e);var o={redirectUri:e},r={redirectUri:null===(t=this.keycloak)||void 0===t?void 0:t.createLogoutUrl(o)};null===(i=this.keycloak)||void 0===i||i.logout(r)},t.prototype.login=function(){return r(this,void 0,void 0,(function(){var t;return a(this,(function(i){switch(i.label){case 0:return t=function(){},[4,this.init(t)];case 1:return i.sent(),[2]}}))}))},t}()}}]);