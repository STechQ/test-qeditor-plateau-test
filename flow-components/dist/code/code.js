!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flowcomponent=t():e.flowcomponent=t()}(this,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>a});let o=!1;new Promise((e=>e())).then((()=>o=!0)),"undefined"!=typeof doNothing&&doNothing();const r=!0===o;class n extends Error{get detail(){return this._detail}constructor(e){super(e.message),this.name=n.FlowErrorName,e.stack&&(this.stack=e.stack),this.type=e.type,this.code=e.code,this.summary=e.summary,this.parameters=e.parameters,this.category=e.category,this._detail=e.detail}static isFlowError(e){return e instanceof n||e.name==n.FlowErrorName}appendDetail(e){this._detail=this._detail?this._detail+" - "+e:e}}function s(e){const{workflow:t,client:o,server:r,wfe:n}=e;if(t)return{type:"workflow",...t.context()||{action:void 0},constants:t.constantsWId};if(o)return{type:"client"};if(r)return{type:"server"};if(n){const e=n.wfExecutionContext(),{wfEngineOnUs:t,user:o}=e.getWfeOnUs(),{processInstance:r,dataInstance:s,lastAction:i}=t;return{type:"workflowEngine",processInstance:r,dataInstance:s,action:i,currentUser:o}}throw new Error("WTF: where are you executing this flow ???")}n.FlowErrorName="FlowRuntimeError_ae24";const i=async function(){}.constructor,a=async e=>{const t=Object.create(null),o=e.flow.getWorkflow(),a=e.flow.getServer(),c=e.flow.getClient(),l={permanentStore:()=>({set:async(e,t)=>{if(c)throw new Error("Not Implemented: permanentStore is not implemented yet on client.");if(a)throw new Error("Not Implemented: permanentStore is not implemented yet on server.");if(!o)throw new Error("permanent store can be executed only on workflow environment");await o.workflowDb().permanentStore.set(e,t)},get:async e=>{if(c)throw new Error("Not Implemented: permanentStore is not implemented yet on client.");if(a)throw new Error("Not Implemented: permanentStore is not implemented yet on server.");if(!o)throw new Error("permanent store can be executed only on workflow environment");return await o.workflowDb().permanentStore.get(e)}}),getIncomingRequest:()=>{if(a)throw new Error("Not Implemented: server request is not implemented yet.");if(!o)throw new Error("request can only be used on SERVER or WORKFLOW");const e=o.getIncomingRequest(),t=e.headers.additionalHeaders?JSON.parse(e.headers.additionalHeaders):{};return Object.keys(t).forEach((o=>{e.headers[o]=t[o]})),delete e.headers.additionalHeaders,e},context:s({client:c,server:a,workflow:o}),input:e.msg.input,output:e.msg.output,vars:e.msg.vars,appendFlowInfo:t=>{e.msg.infoList=e.msg.infoList||[],e.msg.infoList.push(t)},createError:e=>new n(e),addActivity:async e=>{if(!o)throw new Error("request can only be used on SERVER or WORKFLOW");await o.addActivity(e)},randomUUID:()=>crypto.randomUUID(),log:(e,...t)=>{console.log(e,...t)},openProcessbyLock:async e=>await(null==o?void 0:o.wfe.processContext.retrieveContext(e)),resumeProcess:async(e,t,r,n)=>{const s={processInstanId:e,taskId:t,dataInstance:r,customType:n};return await(null==o?void 0:o.wfe.processContext.resumeProcess(s))}};let d,m=!1;e.props.waitTillNext&&(d=function(e,t={}){let o,n,s;const i=e=>{s&&clearTimeout(s),s=setTimeout((()=>{n(new Error(`The operation has timed out. timeoutValue  : ${e}`))}),e)};return e&&i(e),{startTimer:i,promise:new Promise(((e,s)=>{var i;i=e,o=r&&t.fixSyncResolve?e=>setTimeout((()=>i(e))):i,n=s})),resolver:o,reject:n}}(),l.next=()=>{m||(m=!0,e.flow.next(),d.resolver())},l.fail=e=>{m||(m=!0,d.reject(e))});const p=i("window","global","globalThis","flow","document","XMLHttpRequest","fetch","setInterval","navigator",e.props.code).apply(t,[t,t,t,l,void 0,void 0,void 0,void 0,void 0]);d?await d.promise:(await p,e.flow.next())};return t})()));