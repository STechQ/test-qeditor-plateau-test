exports.id=2342,exports.ids=[2342],exports.modules={8934:(e,t,i)=>{"use strict";var s=i(42669),n=[];function r(){this.task=null,this.domain=null}e.exports=function(e){var t;(t=n.length?n.pop():new r).task=e,t.domain=process.domain,s(t)},r.prototype.call=function(){this.domain&&this.domain.enter();var e=!0;try{this.task.call(),e=!1,this.domain&&this.domain.exit()}finally{e&&s.requestFlush(),this.task=null,this.domain=null,n.push(this)}}},42669:(e,t,i)=>{"use strict";var s,n="function"==typeof setImmediate;function r(e){a.length||(c(),o=!0),a[a.length]=e}e.exports=r;var a=[],o=!1,h=0,l=1024;function d(){for(;h<a.length;){var e=h;if(h+=1,a[e].call(),h>l){for(var t=0,i=a.length-h;t<i;t++)a[t]=a[t+h];a.length-=h,h=0}}a.length=0,h=0,o=!1}function c(){var e=process.domain;e&&(s||(s=i(13639)),s.active=process.domain=null),o&&n?setImmediate(d):process.nextTick(d),e&&(s.active=process.domain=e)}r.requestFlush=c},61067:(e,t,i)=>{var s=i(31993);e.exports=s((function(e){var t=!0;return n((function(){t=!1})),function(){var i=arguments,s=this;t?n((function(){e.apply(s,i)})):e.apply(s,i)}}));var n=i(8934)},31744:(e,t,i)=>{var s=i(31993);function n(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function r(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},i=e.name||"Function wrapped with `once`";return t.onceError=i+" shouldn't be called more than once",t.called=!1,t}e.exports=s(n),e.exports.strict=s(r),n.proto=n((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return r(this)},configurable:!0})}))},31993:e=>{e.exports=function e(t,i){if(t&&i)return e(t)(i);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){s[e]=t[e]})),s;function s(){for(var e=new Array(arguments.length),i=0;i<e.length;i++)e[i]=arguments[i];var s=t.apply(this,e),n=e[e.length-1];return"function"==typeof s&&s!==n&&Object.keys(n).forEach((function(e){s[e]=n[e]})),s}}},62342:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DummyParser:()=>pe,File:()=>h,Formidable:()=>Ee,IncomingForm:()=>Ee,JSONParser:()=>he,MultipartParser:()=>ne,OctetStreamParser:()=>F,OctetstreamParser:()=>F,PersistentFile:()=>h,QueryStringParser:()=>T,QuerystringParser:()=>T,VolatileFile:()=>d,default:()=>Se,defaultOptions:()=>me,enabledPlugins:()=>we,errors:()=>s,formidable:()=>Fe,json:()=>de,multipart:()=>ae,octetstream:()=>S,querystring:()=>v});var s={};i.r(s),i.d(s,{aborted:()=>O,biggerThanMaxFileSize:()=>q,biggerThanTotalMaxFileSize:()=>H,cannotCreateDir:()=>Y,default:()=>Z,filenameNotString:()=>L,malformedMultipart:()=>B,maxFieldsExceeded:()=>I,maxFieldsSizeExceeded:()=>U,maxFilesExceeded:()=>W,missingContentType:()=>$,missingMultipartBoundary:()=>j,missingPlugin:()=>k,noEmptyFiles:()=>M,noParser:()=>z,pluginFailed:()=>J,pluginFunction:()=>P,smallerThanMinFileSize:()=>C,uninitializedParser:()=>N,unknownTransferEncoding:()=>V});var n=i(87561),r=i(6005),a=i(15673);class o extends a.EventEmitter{constructor({filepath:e,newFilename:t,originalFilename:i,mimetype:s,hashAlgorithm:n}){super(),this.lastModifiedDate=null,Object.assign(this,{filepath:e,newFilename:t,originalFilename:i,mimetype:s,hashAlgorithm:n}),this.size=0,this._writeStream=null,"string"==typeof this.hashAlgorithm?this.hash=r.createHash(this.hashAlgorithm):this.hash=null}open(){this._writeStream=n.createWriteStream(this.filepath),this._writeStream.on("error",(e=>{this.emit("error",e)}))}toJSON(){const e={size:this.size,filepath:this.filepath,newFilename:this.newFilename,mimetype:this.mimetype,mtime:this.lastModifiedDate,length:this.length,originalFilename:this.originalFilename};return this.hash&&""!==this.hash&&(e.hash=this.hash),e}toString(){return`PersistentFile: ${this.newFilename}, Original: ${this.originalFilename}, Path: ${this.filepath}`}write(e,t){this.hash&&this.hash.update(e),this._writeStream.closed?t():this._writeStream.write(e,(()=>{this.lastModifiedDate=new Date,this.size+=e.length,this.emit("progress",this.size),t()}))}end(e){this.hash&&(this.hash=this.hash.digest("hex")),this._writeStream.end((()=>{this.emit("end"),e()}))}destroy(){this._writeStream.destroy();const e=this.filepath;setTimeout((function(){n.unlink(e,(()=>{}))}),1)}}const h=o;class l extends a.EventEmitter{constructor({filepath:e,newFilename:t,originalFilename:i,mimetype:s,hashAlgorithm:n,createFileWriteStream:a}){super(),this.lastModifiedDate=null,Object.assign(this,{filepath:e,newFilename:t,originalFilename:i,mimetype:s,hashAlgorithm:n,createFileWriteStream:a}),this.size=0,this._writeStream=null,"string"==typeof this.hashAlgorithm?this.hash=(0,r.createHash)(this.hashAlgorithm):this.hash=null}open(){this._writeStream=this.createFileWriteStream(this),this._writeStream.on("error",(e=>{this.emit("error",e)}))}destroy(){this._writeStream.destroy()}toJSON(){const e={size:this.size,newFilename:this.newFilename,length:this.length,originalFilename:this.originalFilename,mimetype:this.mimetype};return this.hash&&""!==this.hash&&(e.hash=this.hash),e}toString(){return`VolatileFile: ${this.originalFilename}`}write(e,t){this.hash&&this.hash.update(e),this._writeStream.closed||this._writeStream.destroyed?t():this._writeStream.write(e,(()=>{this.size+=e.length,this.emit("progress",this.size),t()}))}end(e){this.hash&&(this.hash=this.hash.digest("hex")),this._writeStream.end((()=>{this.emit("end"),e()}))}}const d=l;for(var c=i(70612),u=i(49411),p=i(93977),f=i(76915),m=256,g=[];m--;)g[m]=(m+256).toString(16).substring(1);var _=i(31744),b=i(61067),y=i(84492);class E extends y.PassThrough{constructor(e={}){super(),this.globalOptions={...e}}}const F=E,w="octet-stream";async function S(e,t){const i=this||e;return/octet-stream/i.test(i.headers["content-type"])&&await x.call(i,i,t),i}async function x(e,t){this.type=w;const i=this.headers["x-file-name"],s=this.headers["content-type"],n={originalFilename:i,mimetype:s},r=this._getNewName(n),a=this._joinDirectoryName(r),o=await this._newFile({newFilename:r,filepath:a,originalFilename:i,mimetype:s});this.emit("fileBegin",i,o),o.open(),this.openedFiles.push(o),this._flushing+=1,this._parser=new F(this.options);let h=0;return this._parser.on("data",(e=>{this.pause(),h+=1,o.write(e,(()=>{h-=1,this.resume(),this.ended&&this._parser.emit("doneWritingFile")}))})),this._parser.on("end",(()=>{this._flushing-=1,this.ended=!0;const e=()=>{o.end((()=>{this.emit("file","file",o),this._maybeEnd()}))};0===h?e():this._parser.once("doneWritingFile",e)})),this}class A extends y.Transform{constructor(e={}){super({readableObjectMode:!0}),this.globalOptions={...e},this.buffer="",this.bufferLength=0}_transform(e,t,i){this.buffer+=e.toString("ascii"),this.bufferLength=this.buffer.length,i()}_flush(e){const t=new URLSearchParams(this.buffer);for(const[e,i]of t)this.push({key:e,value:i});this.buffer="",e()}}const T=A,D="urlencoded";function v(e,t){const i=this||e;return/urlencoded/i.test(i.headers["content-type"])&&R.call(i,i,t),i}function R(e,t){this.type=D;const i=new T(this.options);return i.on("data",(({key:e,value:t})=>{this.emit("field",e,t)})),i.once("end",(()=>{this.ended=!0,this._maybeEnd()})),this._parser=i,this}const k=1e3,P=1001,O=1002,z=1003,N=1004,L=1005,U=1006,I=1007,C=1008,H=1009,M=1010,$=1011,B=1012,j=1013,V=1014,W=1015,q=1016,J=1017,Y=1018,Z=class extends Error{constructor(e,t,i=500){super(e),this.code=t,this.httpCode=i}};let Q=0;const G={PARSER_UNINITIALIZED:Q++,START:Q++,START_BOUNDARY:Q++,HEADER_FIELD_START:Q++,HEADER_FIELD:Q++,HEADER_VALUE_START:Q++,HEADER_VALUE:Q++,HEADER_VALUE_ALMOST_DONE:Q++,HEADERS_ALMOST_DONE:Q++,PART_DATA_START:Q++,PART_DATA:Q++,PART_END:Q++,END:Q++};let K=1;const X=K,ee=K*=2;function te(e){return 32|e}const ie={};Object.keys(G).forEach((e=>{ie[e]=G[e]}));class se extends y.Transform{constructor(e={}){super({readableObjectMode:!0}),this.boundary=null,this.boundaryChars=null,this.lookbehind=null,this.bufferLength=0,this.state=G.PARSER_UNINITIALIZED,this.globalOptions={...e},this.index=null,this.flags=0}_endUnexpected(){return new Z(`MultipartParser.end(): stream ended unexpectedly: ${this.explain()}`,B,400)}_flush(e){this.state===G.HEADER_FIELD_START&&0===this.index||this.state===G.PART_DATA&&this.index===this.boundary.length?(this._handleCallback("partEnd"),this._handleCallback("end"),e()):this.state!==G.END?e(this._endUnexpected()):e()}initWithBoundary(e){this.boundary=Buffer.from(`\r\n--${e}`),this.lookbehind=Buffer.alloc(this.boundary.length+8),this.state=G.START,this.boundaryChars={};for(let e=0;e<this.boundary.length;e++)this.boundaryChars[this.boundary[e]]=!0}_handleCallback(e,t,i,s){void 0!==i&&i===s||this.push({name:e,buffer:t,start:i,end:s})}_transform(e,t,i){let s=0,n=this.index,{index:r,state:a,flags:o}=this;const{lookbehind:h,boundary:l,boundaryChars:d}=this,c=l.length,u=c-1;this.bufferLength=e.length;let p=null,f=null;const m=(e,t)=>{this[`${e}Mark`]="number"==typeof t?t:s},g=e=>{delete this[`${e}Mark`]},_=(t,i)=>{const n=`${t}Mark`;n in this&&(i?(this._handleCallback(t,e,this[n],s),g(t)):(this._handleCallback(t,e,this[n],e.length),m(t,0)))};for(s=0;s<this.bufferLength;s++)switch(p=e[s],a){case G.PARSER_UNINITIALIZED:return void i(this._endUnexpected());case G.START:r=0,a=G.START_BOUNDARY;case G.START_BOUNDARY:if(r===l.length-2){if(45===p)o|=ee;else if(13!==p)return void i(this._endUnexpected());r++;break}if(r-1==l.length-2){if(o&ee&&45===p)this._handleCallback("end"),a=G.END,o=0;else{if(o&ee||10!==p)return void i(this._endUnexpected());r=0,this._handleCallback("partBegin"),a=G.HEADER_FIELD_START}break}p!==l[r+2]&&(r=-2),p===l[r+2]&&r++;break;case G.HEADER_FIELD_START:a=G.HEADER_FIELD,m("headerField"),r=0;case G.HEADER_FIELD:if(13===p){g("headerField"),a=G.HEADERS_ALMOST_DONE;break}if(r++,45===p)break;if(58===p){if(1===r)return void i(this._endUnexpected());_("headerField",!0),a=G.HEADER_VALUE_START;break}if(f=te(p),f<97||f>122)return void i(this._endUnexpected());break;case G.HEADER_VALUE_START:if(32===p)break;m("headerValue"),a=G.HEADER_VALUE;case G.HEADER_VALUE:13===p&&(_("headerValue",!0),this._handleCallback("headerEnd"),a=G.HEADER_VALUE_ALMOST_DONE);break;case G.HEADER_VALUE_ALMOST_DONE:if(10!==p)return void i(this._endUnexpected());a=G.HEADER_FIELD_START;break;case G.HEADERS_ALMOST_DONE:if(10!==p)return void i(this._endUnexpected());this._handleCallback("headersEnd"),a=G.PART_DATA_START;break;case G.PART_DATA_START:a=G.PART_DATA,m("partData");case G.PART_DATA:if(n=r,0===r){for(s+=u;s<this.bufferLength&&!(e[s]in d);)s+=c;s-=u,p=e[s]}if(r<l.length)l[r]===p?(0===r&&_("partData",!0),r++):r=0;else if(r===l.length)r++,13===p?o|=X:45===p?o|=ee:r=0;else if(r-1===l.length)if(o&X){if(r=0,10===p){o&=~X,this._handleCallback("partEnd"),this._handleCallback("partBegin"),a=G.HEADER_FIELD_START;break}}else o&ee&&45===p?(this._handleCallback("partEnd"),this._handleCallback("end"),a=G.END,o=0):r=0;r>0?h[r-1]=p:n>0&&(this._handleCallback("partData",h,0,n),n=0,m("partData"),s--);break;case G.END:break;default:return void i(this._endUnexpected())}return _("headerField"),_("headerValue"),_("partData"),this.index=r,this.state=a,this.flags=o,i(),this.bufferLength}explain(){return`state = ${se.stateToString(this.state)}`}}se.stateToString=e=>{for(const t in G)if(G[t]===e)return t};const ne=Object.assign(se,{STATES:ie}),re="multipart";function ae(e,t){const i=this||e;if(/multipart/i.test(i.headers["content-type"])){const e=i.headers["content-type"].match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(e){const n=(s=e[1]||e[2],function(){this.type=re;const e=new ne(this.options);let t,i,n;e.initWithBoundary(s),e.on("data",(async({name:s,buffer:r,start:a,end:o})=>{if("partBegin"===s)n=new y.Stream,n.readable=!0,n.headers={},n.name=null,n.originalFilename=null,n.mimetype=null,n.transferEncoding=this.options.encoding,n.transferBuffer="",t="",i="";else if("headerField"===s)t+=r.toString(this.options.encoding,a,o);else if("headerValue"===s)i+=r.toString(this.options.encoding,a,o);else if("headerEnd"===s){t=t.toLowerCase(),n.headers[t]=i;const e=i.match(/\bname=("([^"]*)"|([^\(\)<>@,;:\\"\/\[\]\?=\{\}\s\t/]+))/i);"content-disposition"===t?(e&&(n.name=e[2]||e[3]||""),n.originalFilename=this._getFileName(i)):"content-type"===t?n.mimetype=i:"content-transfer-encoding"===t&&(n.transferEncoding=i.toLowerCase()),t="",i=""}else if("headersEnd"===s){switch(n.transferEncoding){case"binary":case"7bit":case"8bit":case"utf-8":{const t=e=>{"partData"===e.name&&n.emit("data",e.buffer.slice(e.start,e.end))},i=s=>{"partEnd"===s.name&&(n.emit("end"),e.off("data",t),e.off("data",i))};e.on("data",t),e.on("data",i);break}case"base64":{const t=e=>{if("partData"===e.name){n.transferBuffer+=e.buffer.slice(e.start,e.end).toString("ascii");const t=4*parseInt(n.transferBuffer.length/4,10);n.emit("data",Buffer.from(n.transferBuffer.substring(0,t),"base64")),n.transferBuffer=n.transferBuffer.substring(t)}},i=s=>{"partEnd"===s.name&&(n.emit("data",Buffer.from(n.transferBuffer,"base64")),n.emit("end"),e.off("data",t),e.off("data",i))};e.on("data",t),e.on("data",i);break}default:return this._error(new Z("unknown transfer-encoding",V,501))}this._parser.pause(),await this.onPart(n),this._parser.resume()}else"end"===s&&(this.ended=!0,this._maybeEnd())})),this._parser=e});n.call(i,i,t)}else{const e=new Z("bad content-type header, no multipart boundary",j,400);i._error(e)}}var s;return i}class oe extends y.Transform{constructor(e={}){super({readableObjectMode:!0}),this.chunks=[],this.globalOptions={...e}}_transform(e,t,i){this.chunks.push(String(e)),i()}_flush(e){try{const e=JSON.parse(this.chunks.join(""));this.push(e)}catch(t){return void e(t)}this.chunks=null,e()}}const he=oe,le="json";function de(e,t){const i=this||e;return/json/i.test(i.headers["content-type"])&&ce.call(i,i,t),i}function ce(e,t){this.type=le;const i=new he(this.options);i.on("data",(e=>{this.fields=e})),i.once("end",(()=>{this.ended=!0,this._maybeEnd()})),this._parser=i}class ue extends y.Transform{constructor(e,t={}){super(),this.globalOptions={...t},this.incomingForm=e}_flush(e){this.incomingForm.ended=!0,this.incomingForm._maybeEnd(),e()}}const pe=ue,fe=function(e){e=e||16;var t="",i=0;return function(){if(!t||256===i){for(t="",i=(1+e)/2|0;i--;)t+=g[256*Math.random()|0];t=t.substring(i=0,e-2)}return t+g[i++]}}(25),me={maxFields:1e3,maxFieldsSize:20971520,maxFiles:1/0,maxFileSize:209715200,maxTotalFileSize:void 0,minFileSize:1,allowEmptyFiles:!1,createDirsFromUploads:!1,keepExtensions:!1,encoding:"utf-8",hashAlgorithm:!1,uploadDir:c.tmpdir(),enabledPlugins:[S,v,ae,de],fileWriteStreamHandler:null,defaultInvalidName:"invalid-name",filter:e=>!0,filename:void 0};function ge(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const _e=function(e){let t=Promise.resolve();return async function(...e){const i=t;let s,n;return t=new Promise((function(e){n=e})),await i,s=function(e){const t=u.dirname(e);return p.mkdir(t,{recursive:!0})}(...e),s.then(n).catch(n),s}}(),be=e=>{const t=e.charCodeAt(0);return!(46===t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)};class ye extends a.EventEmitter{constructor(e={}){super(),this.options={...me,...e},this.options.maxTotalFileSize||(this.options.maxTotalFileSize=this.options.maxFileSize);const t=u.resolve(this.options.uploadDir||this.options.uploaddir||c.tmpdir());if(this.uploaddir=t,this.uploadDir=t,["error","headers","type","bytesExpected","bytesReceived","_parser","req"].forEach((e=>{this[e]=null})),this._setUpRename(),this._flushing=0,this._fieldsSize=0,this._totalFileSize=0,this._plugins=[],this.openedFiles=[],this.options.enabledPlugins=[].concat(this.options.enabledPlugins).filter(Boolean),0===this.options.enabledPlugins.length)throw new Z("expect at least 1 enabled builtin plugin, see options.enabledPlugins",k);this.options.enabledPlugins.forEach((e=>{this.use(e)})),this._setUpMaxFields(),this._setUpMaxFiles(),this.ended=void 0,this.type=void 0}use(e){if("function"!=typeof e)throw new Z(".use: expect `plugin` to be a function",P);return this._plugins.push(e.bind(this)),this}pause(){try{this.req.pause()}catch(e){return this.ended||this._error(e),!1}return!0}resume(){try{this.req.resume()}catch(e){return this.ended||this._error(e),!1}return!0}async parse(e,t){let i;if(this.req=e,!t){let e,s;i=new Promise(((t,i)=>{e=t,s=i})),t=(t,i,n)=>{t?s(t):e([i,n])}}const s=_(b(t));this.fields={};const n={};return this.on("field",((e,t)=>{"multipart"===this.type||"urlencoded"===this.type?ge(this.fields,e)?this.fields[e].push(t):this.fields[e]=[t]:this.fields[e]=t})),this.on("file",((e,t)=>{ge(n,e)?n[e].push(t):n[e]=[t]})),this.on("error",(e=>{s(e,this.fields,n)})),this.on("end",(()=>{s(null,this.fields,n)})),await this.writeHeaders(e.headers),e.on("error",(e=>{this._error(e)})).on("aborted",(()=>{this.emit("aborted"),this._error(new Z("Request aborted",O))})).on("data",(e=>{try{this.write(e)}catch(e){this._error(e)}})).on("end",(()=>{this.error||this._parser&&this._parser.end()})),i||this}async writeHeaders(e){this.headers=e,this._parseContentLength(),await this._parseContentType(),this._parser?this._parser.once("error",(e=>{this._error(e)})):this._error(new Z("no parser found",z,415))}write(e){return this.error?null:this._parser?(this.bytesReceived+=e.length,this.emit("progress",this.bytesReceived,this.bytesExpected),this._parser.write(e),this.bytesReceived):(this._error(new Z("uninitialized parser",N)),null)}onPart(e){return this._handlePart(e)}async _handlePart(e){if(e.originalFilename&&"string"!=typeof e.originalFilename)return void this._error(new Z("the part.originalFilename should be string when it exists",L));if(!e.mimetype){let t="";const i=new f.StringDecoder(e.transferEncoding||this.options.encoding);return e.on("data",(e=>{this._fieldsSize+=e.length,this._fieldsSize>this.options.maxFieldsSize?this._error(new Z(`options.maxFieldsSize (${this.options.maxFieldsSize} bytes) exceeded, received ${this._fieldsSize} bytes of field data`,U,413)):t+=i.write(e)})),void e.on("end",(()=>{this.emit("field",e.name,t)}))}if(!this.options.filter(e))return;this._flushing+=1;let t=0;const i=this._getNewName(e),s=this._joinDirectoryName(i),n=await this._newFile({newFilename:i,filepath:s,originalFilename:e.originalFilename,mimetype:e.mimetype});n.on("error",(e=>{this._error(e)})),this.emit("fileBegin",e.name,n),n.open(),this.openedFiles.push(n),e.on("data",(e=>{this._totalFileSize+=e.length,t+=e.length,this._totalFileSize>this.options.maxTotalFileSize?this._error(new Z(`options.maxTotalFileSize (${this.options.maxTotalFileSize} bytes) exceeded, received ${this._totalFileSize} bytes of file data`,H,413)):0!==e.length&&(this.pause(),n.write(e,(()=>{this.resume()})))})),e.on("end",(()=>{this.options.allowEmptyFiles||0!==t?t<this.options.minFileSize?this._error(new Z(`options.minFileSize (${this.options.minFileSize} bytes) inferior, received ${t} bytes of file data`,C,400)):t>this.options.maxFileSize?this._error(new Z(`options.maxFileSize (${this.options.maxFileSize} bytes), received ${t} bytes of file data`,q,413)):n.end((()=>{this._flushing-=1,this.emit("file",e.name,n),this._maybeEnd()})):this._error(new Z("options.allowEmptyFiles is false, file size should be greater than 0",M,400))}))}async _parseContentType(){0!==this.bytesExpected?this.headers["content-type"]?(new pe(this,this.options),await Promise.all(this._plugins.map((async(e,t)=>{let i=null;try{i=await e(this,this.options)||this}catch(e){const i=new Z(`plugin on index ${t} failed with: ${e.message}`,J,500);throw i.idx=t,i}Object.assign(this,i),this.emit("plugin",t,i)}))),this.emit("pluginsResults",[])):this._error(new Z("bad content-type header, no content-type",$,400)):this._parser=new pe(this,this.options)}_error(e,t="error"){this.error||this.ended||(this.req=null,this.error=e,this.emit(t,e),this.openedFiles.forEach((e=>{e.destroy()})))}_parseContentLength(){this.bytesReceived=0,this.headers["content-length"]?this.bytesExpected=parseInt(this.headers["content-length"],10):void 0===this.headers["transfer-encoding"]&&(this.bytesExpected=0),null!==this.bytesExpected&&this.emit("progress",this.bytesReceived,this.bytesExpected)}_newParser(){return new ne(this.options)}async _newFile({filepath:e,originalFilename:t,mimetype:i,newFilename:s}){if(this.options.fileWriteStreamHandler)return new d({newFilename:s,filepath:e,originalFilename:t,mimetype:i,createFileWriteStream:this.options.fileWriteStreamHandler,hashAlgorithm:this.options.hashAlgorithm});if(this.options.createDirsFromUploads)try{await _e(e)}catch(e){this._error(new Z("cannot create directory",Y,409))}return new h({newFilename:s,filepath:e,originalFilename:t,mimetype:i,hashAlgorithm:this.options.hashAlgorithm})}_getFileName(e){const t=e.match(/\bfilename=("(.*?)"|([^()<>{}[\]@,;:"?=\s/\t]+))($|;\s)/i);if(!t)return null;const i=t[2]||t[3]||"";let s=i.substr(i.lastIndexOf("\\")+1);return s=s.replace(/%22/g,'"'),s=s.replace(/&#([\d]{4});/g,((e,t)=>String.fromCharCode(t))),s}_getExtension(e){if(!e)return"";const t=u.basename(e),i=t.indexOf("."),s=t.lastIndexOf(".");let n,r=u.extname(t);i!==s&&(r=t.slice(i));const a=Array.from(r).findIndex(be);return n=-1===a?r:r.substring(0,a),"."===n?"":n}_joinDirectoryName(e){const t=u.join(this.uploadDir,e);return t.startsWith(this.uploadDir)?t:u.join(this.uploadDir,this.options.defaultInvalidName)}_setUpRename(){const e="function"==typeof this.options.filename;this._getNewName=e?e=>{let t="",i=this.options.defaultInvalidName;return e.originalFilename&&(({ext:t,name:i}=u.parse(e.originalFilename)),!0!==this.options.keepExtensions&&(t="")),this.options.filename.call(this,i,t,e,this)}:e=>{const t=fe();if(e&&this.options.keepExtensions){const i="string"==typeof e?e:e.originalFilename;return`${t}${this._getExtension(i)}`}return t}}_setUpMaxFields(){if(this.options.maxFields!==1/0){let e=0;this.on("field",(()=>{e+=1,e>this.options.maxFields&&this._error(new Z(`options.maxFields (${this.options.maxFields}) exceeded`,I,413))}))}}_setUpMaxFiles(){if(this.options.maxFiles!==1/0){let e=0;this.on("fileBegin",(()=>{e+=1,e>this.options.maxFiles&&this._error(new Z(`options.maxFiles (${this.options.maxFiles}) exceeded`,W,413))}))}}_maybeEnd(){!this.ended||this._flushing||this.error||(this.req=null,this.emit("end"))}}const Ee=ye,Fe=(...e)=>new Ee(...e),{enabledPlugins:we}=me,Se=Fe}};