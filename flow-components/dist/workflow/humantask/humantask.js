!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flowcomponent=t():e.flowcomponent=t()}(this,()=>(()=>{"use strict";var __webpack_modules__={59232:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>isomorphicCrypto});const isomorphicCrypto="undefined"!=typeof crypto?eval("crypto"):global.crypto=eval("require")("crypto")}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>D});class e extends Error{static isWrappedFlowError(t){return t instanceof e||t.name==e.name}constructor(t){super(t.message),this.orig_error=t,this.name=e.WrappedFlowErrorName}}e.WrappedFlowErrorName="WrappedFlowError_ae24";class t extends Error{get detail(){return this._detail}constructor(e){super(e.message),this.name=t.FlowErrorName,e.stack&&(this.stack=e.stack),this.type=e.type,this.code=e.code,this.summary=e.summary,this.parameters=e.parameters,this.category=e.category,this._detail=e.detail}static isFlowError(e){return e instanceof t||e.name==t.FlowErrorName}appendDetail(e){this._detail=this._detail?this._detail+" - "+e:e}}t.FlowErrorName="FlowRuntimeError_ae24";const a={start:"Ä°ÅŸlem BaÅŸlatÄ±ldÄ±",complete:"GÃ¶rev TamamlandÄ±",cancel:"Ä°ptal Edildi",return:"Ä°ade Edildi",finish:"SÃ¼reÃ§ TamamlandÄ±",update:"GÃ¼ncellendi",assignToUser:"KullanÄ±cÄ±ya Atama",assignToUnit:"Birime Atama",assignToSwimlane:"Havuza Atama",save:"Kaydedildi",addNote:"Not Eklendi",updateNote:"Not GÃ¼ncellendi",deleteNote:"Not Silindi",function:"Fonksiyon Ã‡alÄ±ÅŸtÄ±rÄ±ldÄ±",fileUpload:"Dosya YÃ¼klendi",fileDownload:"Dosya Ä°ndirildi",fileDelete:"Dosya Silindi",statusChanged:"Durum DeÄŸiÅŸti",threadRetried:"Tekrar Denendi",terminate:"Process SonlandÄ±rÄ±ldÄ±",changeStep:"Step DeÄŸiÅŸtirildi"},s={start:"Process Started",complete:"Task Completed",cancel:"Cancelled",return:"Rejected",finish:"Process Finished",update:"Updated",assignToUser:"User Assignement",assignToUnit:"Unit Assignment",assignToSwimlane:"Swimlane Assignment",save:"Saved",addNote:"Note Added",updateNote:"Note Updated",deleteNote:"Note Deleted",function:"Function Run",fileUpload:"File Uploaded",fileDownload:"File Downloaded",fileDelete:"File Deleted",statusChanged:"Status Changed",threadRetried:"Retried",terminate:"Process Terminated",changeStep:"Change Step"};class r{static getDescription(e,t){let r=e||"";return r="tr_TR"===t?Object.keys(a).includes(e)?a[e]:r:Object.keys(s).includes(e)?s[e]:r,r}}let n;n={getUser:{name:"getUser",type:"flow"},notify:{name:"notify",type:"flow"},userTaskActivity:{name:"userTaskActivity",type:"flow"},preForm:{name:"TaskPreview",type:"qjson"}},n={iPaasEndPoint:{name:"IPaaS_Endpoint",type:"constant"}};const o={"":"Custom","Pending-InProgress":"Pending-InProgress","Pending-Approval":"Pending-Approval","Resolved-Completed":"Resolved-Completed",New:"New",Returned:"Returned","Returned-Originator":"Returned-Originator","Returned-Recipient":"Returned-Recipient","Resolved-Cancelled":"Resolved-Cancelled"},i={"":"StatÃ¼ Yok","Pending-InProgress":"Ä°ÅŸlemde","Pending-Approval":"Bekliyor-Onay","Resolved-Completed":"TamamlandÄ±",New:"Yeni",Returned:"Ä°ade","Returned-Originator":"GiriÅŸÃ§iye Ä°ade Edildi","Returned-Recipient":"Ã‡alÄ±ÅŸana Ä°ade Edildi","Resolved-Cancelled":"Ä°ptal Edildi"};class c{static getDescription(e,t){return("tr_TR"==t?i:o)[e]||e||""}}const d="flowThreadId";class l extends Error{static isCustomError(e){return e instanceof l||e.name==l.CustomErrorName}get detail(){return this._detail}constructor(e){super(e.message),this.name=l.CustomErrorName,e.stack&&(this.stack=e.stack),this.type=e.type,this.code=e.code,this.summary=e.summary,this.parameters=e.parameters,this.category=e.category,this._detail=e.detail,this.statusCode=e.statusCode}toJSON(){const e={statusCode:this.statusCode,type:this.type,category:this.category,code:this.code,summary:this.summary,parameters:this.parameters,detail:this.detail,stack:this.stack,message:this.message,additionals:this.additionals};return JSON.stringify(e)}getAdditionalSetter(){return(e,t)=>{this.additionals=this.additionals||{},this.additionals[e]=t}}appendDetail(e){this._detail=this._detail?this._detail+" - "+e:e}}l.CustomErrorName="CustomError_WF_ae24";const u="WM-2730",p={messages:{startWasNotOnUs:e=>`process ${e} start was not on us. ðŸ˜¢`,wfeWasNotOnUs:({prefix:e,suffix:t})=>`${e?e+" ":""}workflow engine was not on us. ðŸ˜¢${t?" "+t:""}`,workflowEngineWasOnUs:({prefix:e,suffix:t})=>`${e?e+" ":""}workflow engine was on us. ðŸ¤”${t?" "+t:""}`},errors:{di404:(e,t)=>new l({statusCode:404,message:`dataInstance ${t?"history":""} for piid: ${e} can not be found`,category:"error",code:"WFE-235",type:"technical"}),taskId404:e=>new l({statusCode:404,message:`taskId: ${e} can not be found`,category:"error",code:"WFE-232",type:"technical"}),piid404:e=>new l({statusCode:404,message:`piid: ${e} can not be found`,category:"error",code:"WFE-234",type:"technical"}),ctxErr:e=>new Error(`execution context is missing: ${e}`),ctxOnUsErr:e=>new Error(`wfEngineOnUs is missing: ${e}`)},wfeStepNames:{humanTask:"humantask"},calculations:{collectionName:(e,t)=>e+"_"+t,isSystemStep:e=>p.wfeStepNames.humanTask==e}};class w{static formatDate(e,t){"string"==typeof e&&(e=new Date(e));let a={},s="tr-TR";return t.date&&(s=t.date.locale||s,a={...a,year:"numeric",month:"2-digit",day:"2-digit"}),t.time&&(a.hour=a.minute="2-digit",0!=t.time.second&&(a.second="2-digit")),new Intl.DateTimeFormat(s,a).format(e)}static toLocaleIsoString(e){return e=e||new Date,new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString()}static toDefaultTimeStampString(e){if(!e)return;const t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),r=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0"),i=e.getMilliseconds().toString().padStart(3,"0"),c=e.getTimezoneOffset(),d=Math.floor(Math.abs(c)/60),l=Math.abs(c)%60;return`${t}/${a}/${s} ${r}:${n}:${o}:${i}${(c>0?"-":"+")+String(d).padStart(2,"0")+String(l).padStart(2,"0")}`}static fromDefaultTimeStampString(e){if(!e)return;const t=e.match(/^(\d{4})\/(\d{2})\/(\d{2}) (\d{2}):(\d{2}):(\d{2}):(\d{3})([+-])(\d{2})(\d{2})$/);if(!t)throw new Error("unexpected DefaultTimeStampString format: "+e);const[,a,s,r,n,o,i,c,d,l,u]=t,p=new Date(Date.UTC(parseInt(a),parseInt(s)-1,parseInt(r),parseInt(n),parseInt(o),parseInt(i),parseInt(c))),w=(60*parseInt(l)+parseInt(u))*("+"===d?1:-1);return p.setMinutes(p.getMinutes()-w),p}static toUTCDate(e){return e=e||new Date,new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static async convertHourToLocal(e,t){let a=(e+(-(new Date).getTimezoneOffset()/60-t))%24;return a<0&&(a+=24),a}static toDateInTimezone(e,t){const a=t- -e.getTimezoneOffset()/60;let s=new Date(e.getTime()+60*a*60*1e3);return s.getHours()<0&&s.setHours(s.getHours()+24),s.getHours()>23&&s.setHours(s.getHours()-24),s}}var m=__webpack_require__(59232);const f=Date.now()-performance.now();class _{static createFastUID(){return Date.now().toString(36).substring(0,9)+Math.random().toString(36).substring(2,13)}static createSecureUID(){const e=(performance.now()+f).toString(36).replace(".","");let t="";const a=m.a.getRandomValues(new Uint8Array(6));for(let e=0;e<6;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[a[e]%62];return e+t}static createUUID(){return m.a.randomUUID()}}var g;function y(e,t,a,s,r){return{processInstanceId:e,taskId:t,dataInstance:a,actionType:s,customType:r}}function h(e){const{workflow:t,client:a,server:s,wfe:r}=e;if(t)return function(e){return{type:"workflow",...e.context()||{action:void 0},constants:e.constantsWId,addActivity:async t=>{await e.addActivity(t)},openProcessbyLock:async t=>await(null==e?void 0:e.wfe.processContext.retrieveContext(t)),complete:async(t,a,s,r,n)=>{const o=y(t,a,s,r,n);return await(null==e?void 0:e.wfe.processContext.complete(o))},commit:async(t,a,s)=>{const r=y(t,a,s);return await(null==e?void 0:e.wfe.processContext.commit(r))},dataSearch:{searchQuery:async t=>await e.wfe.dataSearch.searchQuery(t)},file:{upload:async(t,a,s,r)=>await e.wfe.file.upload(t,a,s,r),delete:async(t,a)=>{await e.wfe.file.delete(t,a)}},thread:{retryBrokenThread:async(t,a)=>await e.wfe.thread.retryBrokenThread(t,a)}}}(t);if(a)return{type:"client"};if(s)return{type:"server"};if(r){const e=r.wfExecutionContext(),{wfEngineOnUs:t,user:a}=e.getWfeOnUs(),{processInstance:s,dataInstance:n,lastAction:o}=t;return{type:"workflowEngine",processInstance:s,dataInstance:n,action:o,currentUser:a}}throw new Error("WTF: where are you executing this flow ???")}function k(e,t){switch(e){case"'":case'"':return[e,t+1];default:return[void 0,t]}}function I(e,t){if(null!=e)return e[t]}function v(e,t){let a=t;const s=e.length;let r,n="",o=!1;for(var i=0;i<s;i++){let t=e[i];if(o)r==t||"]"==t&&!r?(r&&i++,a=I(a,n),n="",o=!1):n+=t;else switch(t){case".":n&&(a=I(a,n)),n="";break;case"[":n&&(a=I(a,n)),n="",[r,i]=k(e[i+1],i),o=!0;break;default:n+=t}}return n&&(a=I(a,n)),a}g={boolean:!0,datetime:!0,number:!0,dataType:!0,string:!0,constant:!0,dataSet:!0,any:!0},Object.keys(g);const T=function(e){return e.client?"client":e.server?"server":e.wfe?"wfe":"workflow"},S=function(e,t,a){switch(null==e?void 0:e.type){case"boolean":return"true"==e.value;case"input":return v(e.value,t.input);case"context":if(a.wfe)return v(e.value,a.wfe.wffContext());if(a.workflow)return v(e.value,a.workflow.context());throw new Error("can not retrieve from Context in "+T(a)+". You can only retrieve Context in workflow.");case"vars":return v(e.value,t.vars);case"output":return v(e.value,t.output);case"constant":if(a.wfe){const t=a.wfe.getConstant(e.value);if(t instanceof Promise)throw new Error("can not retrieve from Constants with async getConstant in "+T(a));return v(e.value,t)}if(a.workflow)return v(e.value,a.workflow.constantsWId);throw new Error("can not retrieve from Constants in "+T(a)+". You can only retrieve Constants in workflow.");case"number":return Number(e.value);case"string":case"enum":return e.value;case"literal":return function(e,t,a){if(""==e)return"";const s=Object.create(null),{input:r,vars:n,output:o}=t,i={input:r,vars:n,output:o,context:h(a)},c=new Function("window","global","globalThis","flow","document","XMLHttpRequest","fetch","setInterval","navigator",`return \`${e}\`;`).apply(s,[s,s,s,i,void 0,void 0,void 0,void 0,void 0]);return"null"===c?null:c}(e.value,t,a);case"notSet":return}},D=async e=>{const a=e.flow.getWFE();if(!a)throw new Error("start step can only be used for workflow flow environment");const s=a.wfExecutionContext(),n=s.getScopeStore(),{wfEngineOnUs:o,userId:i,workflowModel:c,user:l,appId:u}=s.getWfeOnUs(),{processInstance:m,dataInstance:f,wfInput:_}=s.getWfeOnUsProcessInstance(),{trxQueue:g,dsManager:y,taskId:h}=n;if(!y)throw p.errors.ctxErr("dsManager");const{stepStates:k,lastAction:I}=o;if(!g)throw p.errors.ctxErr("trxQueue");const{processId:v,processInstanceId:T,businessKey:S}=m,D=Date.now();if("changeStep"==(null==I?void 0:I.actionType)){const t=await y.Get("WFE_Task",{taskId:h});if(!t)throw new Error(`task not found: ${h}`);const s=o.lastAction;if(!s)throw new Error("no action to complete human task");await a.events.preUserTaskComplete(t,void 0,m,f);const u=s.actionType,p=r.getDescription(s.actionType,"tr_TR");m.lastUpdate=w.toDefaultTimeStampString(new Date(D)),m.lastUpdateUser=l,m.lastUpdateDescriptionCode=u,m.lastUpdateDescription=p,await y.Delete("WFE_Task",{taskId:h},{trxQueue:g}),await y.Update("WFE_ProcessInst",{processInstanceId:T},{updatedAt:D,lastUpdateUser:l,lastUpdateDescriptionCode:u,lastUpdateDescription:p,dataInstance:f},{trxQueue:g}),delete t[d];const I={...t,status:"stepChanged",performerUserId:i,action:s,updatedAt:void 0,endDate:D};await y.Insert("WFE_TaskHistory",I,{trxQueue:g}),m.tasks=m.tasks.filter(e=>e.taskId!=t.taskId),n.taskId=void 0,await a.events.userTaskCompleted(I,{actionType:"changeStep",customType:"",label:"Change Step ",roles:[]},m,f,e.props.sla),await U(o,v,e,T,D,S,m,a,y,g,c,n,f,k,_)}else if(h){const s=await y.Get("WFE_Task",{taskId:h});if(!s)throw new Error(`task not found: ${h}`);if(s.stepId!=e.entryInfo.stepID)throw new Error(`DB task stepID: ${s.stepId} model task stepID: ${e.entryInfo.stepID} mismatch.`);const c=o.lastAction;if(!c)throw new Error("no action to complete human task");switch(null==c?void 0:c.actionType){case"cancel":case"complete":case"return":break;default:throw new Error(`unexpected actionType: ${c.actionType} customType: ${c.customType}`)}const u=e.props.actions.find(e=>e.actionType==c.actionType&&e.customType==c.customType);if(!u)throw new Error("task did not have action: {type: "+c.actionType+", custom: "+c.customType+"}");const p=await y.List("WFE_Activity",{processInstanceId:T}),_=a.converters.convertToIActivities(p);if(!m.tasks.find(e=>e.taskId==s.taskId))throw new Error("unexpected task not found error");const k=await a.authz.canUserPerformActionOnTask(l,s,u,_,m);if("success"!=k.type)return void e.flow.cancel(new t({message:k.message,category:"error",code:k.code,type:"business"}));await a.events.preUserTaskComplete(s,u,m,f);const I=c.actionType,v=r.getDescription(c.actionType,"tr_TR");m.lastUpdate=w.toDefaultTimeStampString(new Date(D)),m.lastUpdateUser=l,m.lastUpdateDescriptionCode=I,m.lastUpdateDescription=v,await y.Delete("WFE_Task",{taskId:h},{trxQueue:g}),await y.Update("WFE_ProcessInst",{processInstanceId:T},{updatedAt:D,lastUpdateUser:l,lastUpdateDescriptionCode:I,lastUpdateDescription:v,dataInstance:f},{trxQueue:g}),delete s[d];const S={...s,status:"completed",performerUserId:i,action:c,updatedAt:void 0,endDate:D};await y.Insert("WFE_TaskHistory",S,{trxQueue:g}),m.tasks=m.tasks.filter(e=>e.taskId!=s.taskId),n.taskId=void 0,await a.events.userTaskCompleted(S,u,m,f,e.props.sla),e.flow.next()}else await U(o,v,e,T,D,S,m,a,y,g,c,n,f,k,_)};async function U(e,t,a,s,r,n,o,i,d,p,w,m,f,g,y){var h;const k=e.lastAction,I=_.createSecureUID()+"-"+t,v=a.entryInfo.inputName,T={processId:t,processInstanceId:s,startDate:r,stepId:a.entryInfo.stepID,stepInputName:v,taskId:I,updatedAt:r,businessKey:n,flowThreadId:a.entryInfo.flowThreadId,customStatus:a.props.taskStatus||a.props.procesStatus||o.status,taskLabel:a.props.label};switch(a.props.sendTo){case"user":const e=a.flow.evalGet({type:"literal",value:a.props.user||""},S);if(!e)throw new l({message:`Target UserId Not Found PID: ${t} TID: ${I} targetUser: ${e}`,statusCode:404,code:u,category:"error",type:"technical"});const s=await i.system.resolveUser(e);if(!s)throw new l({message:`Target User Not Found PID: ${t} TID: ${I} targetUser: ${e}`,statusCode:404,code:u,category:"error",type:"technical"});T.userId=e,T.userName=s.fullName;break;case"swimlane":T.swimlane=await i.system.resolveSwimlane(a.props.swimlane)}if(a.props.sla&&a.props.sla.selectedSlaModelId){const e=await i.system.createSLA(null===(h=a.props.sla)||void 0===h?void 0:h.selectedSlaModelId);T.sla=e.sla,T.priority=e.priority}await d.Insert("WFE_Task",T,{trxQueue:p});const D=await i.converters.convertToITask(T,w),U=o.status;o.tasks.push(D),o.status=a.props.procesStatus||o.status,o.statusDescription=c.getDescription(a.props.procesStatus,"tr_TR"),m.taskId=D.taskId,await i.events.userTaskCreated(T,o,f,k,U!=o.status?{oldStatus:U}:void 0,a.props.sla);const E=i.converters.convertFromIProcessInstAndIDataInst(o,f,{stepStates:g,wfInput:y});await d.Update("WFE_ProcessInst",{processInstanceId:s},E,{trxQueue:p}),i.system.gracefulEnd(),a.flow.pause()}})(),__webpack_exports__})());