!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flowcomponent=t():e.flowcomponent=t()}(this,()=>(()=>{"use strict";var __webpack_modules__={59232:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>isomorphicCrypto});const isomorphicCrypto="undefined"!=typeof crypto?eval("crypto"):global.crypto=eval("require")("crypto")}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>w});var e=__webpack_require__(59232);const t=Date.now()-performance.now();class a{static createFastUID(){return Date.now().toString(36).substring(0,9)+Math.random().toString(36).substring(2,13)}static createSecureUID(){const a=(performance.now()+t).toString(36).replace(".","");let s="";const r=e.a.getRandomValues(new Uint8Array(6));for(let e=0;e<6;e++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[r[e]%62];return a+s}static createUUID(){return e.a.randomUUID()}}class s extends Error{static isCustomError(e){return e instanceof s||e.name==s.CustomErrorName}get detail(){return this._detail}constructor(e){super(e.message),this.name=s.CustomErrorName,e.stack&&(this.stack=e.stack),this.type=e.type,this.code=e.code,this.summary=e.summary,this.parameters=e.parameters,this.category=e.category,this._detail=e.detail,this.statusCode=e.statusCode}toJSON(){const e={statusCode:this.statusCode,type:this.type,category:this.category,code:this.code,summary:this.summary,parameters:this.parameters,detail:this.detail,stack:this.stack,message:this.message,additionals:this.additionals};return JSON.stringify(e)}getAdditionalSetter(){return(e,t)=>{this.additionals=this.additionals||{},this.additionals[e]=t}}appendDetail(e){this._detail=this._detail?this._detail+" - "+e:e}}s.CustomErrorName="CustomError_WF_ae24";class r{static formatDate(e,t){"string"==typeof e&&(e=new Date(e));let a={},s="tr-TR";return t.date&&(s=t.date.locale||s,a={...a,year:"numeric",month:"2-digit",day:"2-digit"}),t.time&&(a.hour=a.minute="2-digit",0!=t.time.second&&(a.second="2-digit")),new Intl.DateTimeFormat(s,a).format(e)}static toLocaleIsoString(e){return e=e||new Date,new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString()}static toDefaultTimeStampString(e){if(!e)return;const t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),r=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0"),i=e.getMilliseconds().toString().padStart(3,"0"),d=e.getTimezoneOffset(),c=Math.floor(Math.abs(d)/60),p=Math.abs(d)%60;return`${t}/${a}/${s} ${r}:${n}:${o}:${i}${(d>0?"-":"+")+String(c).padStart(2,"0")+String(p).padStart(2,"0")}`}static fromDefaultTimeStampString(e){if(!e)return;const t=e.match(/^(\d{4})\/(\d{2})\/(\d{2}) (\d{2}):(\d{2}):(\d{2}):(\d{3})([+-])(\d{2})(\d{2})$/);if(!t)throw new Error("unexpected DefaultTimeStampString format: "+e);const[,a,s,r,n,o,i,d,c,p,l]=t,u=new Date(Date.UTC(parseInt(a),parseInt(s)-1,parseInt(r),parseInt(n),parseInt(o),parseInt(i),parseInt(d))),m=(60*parseInt(p)+parseInt(l))*("+"===c?1:-1);return u.setMinutes(u.getMinutes()-m),u}static toUTCDate(e){return e=e||new Date,new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static async convertHourToLocal(e,t){let a=(e+(-(new Date).getTimezoneOffset()/60-t))%24;return a<0&&(a+=24),a}static toDateInTimezone(e,t){const a=t- -e.getTimezoneOffset()/60;let s=new Date(e.getTime()+60*a*60*1e3);return s.getHours()<0&&s.setHours(s.getHours()+24),s.getHours()>23&&s.setHours(s.getHours()-24),s}}const n={start:"Ä°ÅŸlem BaÅŸlatÄ±ldÄ±",complete:"GÃ¶rev TamamlandÄ±",cancel:"Ä°ptal Edildi",return:"Ä°ade Edildi",finish:"SÃ¼reÃ§ TamamlandÄ±",update:"GÃ¼ncellendi",assignToUser:"KullanÄ±cÄ±ya Atama",assignToUnit:"Birime Atama",assignToSwimlane:"Havuza Atama",save:"Kaydedildi",addNote:"Not Eklendi",updateNote:"Not GÃ¼ncellendi",deleteNote:"Not Silindi",function:"Fonksiyon Ã‡alÄ±ÅŸtÄ±rÄ±ldÄ±",fileUpload:"Dosya YÃ¼klendi",fileDownload:"Dosya Ä°ndirildi",fileDelete:"Dosya Silindi",statusChanged:"Durum DeÄŸiÅŸti",threadRetried:"Tekrar Denendi",terminate:"Process SonlandÄ±rÄ±ldÄ±",changeStep:"Step DeÄŸiÅŸtirildi"},o={start:"Process Started",complete:"Task Completed",cancel:"Cancelled",return:"Rejected",finish:"Process Finished",update:"Updated",assignToUser:"User Assignement",assignToUnit:"Unit Assignment",assignToSwimlane:"Swimlane Assignment",save:"Saved",addNote:"Note Added",updateNote:"Note Updated",deleteNote:"Note Deleted",function:"Function Run",fileUpload:"File Uploaded",fileDownload:"File Downloaded",fileDelete:"File Deleted",statusChanged:"Status Changed",threadRetried:"Retried",terminate:"Process Terminated",changeStep:"Change Step"};class i{static getDescription(e,t){let a=e||"";return a="tr_TR"===t?Object.keys(n).includes(e)?n[e]:a:Object.keys(o).includes(e)?o[e]:a,a}}const d={messages:{startWasNotOnUs:e=>`process ${e} start was not on us. ðŸ˜¢`,wfeWasNotOnUs:({prefix:e,suffix:t})=>`${e?e+" ":""}workflow engine was not on us. ðŸ˜¢${t?" "+t:""}`,workflowEngineWasOnUs:({prefix:e,suffix:t})=>`${e?e+" ":""}workflow engine was on us. ðŸ¤”${t?" "+t:""}`},errors:{di404:(e,t)=>new s({statusCode:404,message:`dataInstance ${t?"history":""} for piid: ${e} can not be found`,category:"error",code:"WFE-235",type:"technical"}),taskId404:e=>new s({statusCode:404,message:`taskId: ${e} can not be found`,category:"error",code:"WFE-232",type:"technical"}),piid404:e=>new s({statusCode:404,message:`piid: ${e} can not be found`,category:"error",code:"WFE-234",type:"technical"}),ctxErr:e=>new Error(`execution context is missing: ${e}`),ctxOnUsErr:e=>new Error(`wfEngineOnUs is missing: ${e}`)},wfeStepNames:{humanTask:"humantask"},calculations:{collectionName:(e,t)=>e+"_"+t,isSystemStep:e=>d.wfeStepNames.humanTask==e}};class c extends Error{static isWrappedFlowError(e){return e instanceof c||e.name==c.name}constructor(e){super(e.message),this.orig_error=e,this.name=c.WrappedFlowErrorName}}c.WrappedFlowErrorName="WrappedFlowError_ae24";class p extends Error{get detail(){return this._detail}constructor(e){super(e.message),this.name=p.FlowErrorName,e.stack&&(this.stack=e.stack),this.type=e.type,this.code=e.code,this.summary=e.summary,this.parameters=e.parameters,this.category=e.category,this._detail=e.detail}static isFlowError(e){return e instanceof p||e.name==p.FlowErrorName}appendDetail(e){this._detail=this._detail?this._detail+" - "+e:e}}let l;p.FlowErrorName="FlowRuntimeError_ae24",l={getUser:{name:"getUser",type:"flow"},notify:{name:"notify",type:"flow"},userTaskActivity:{name:"userTaskActivity",type:"flow"},preForm:{name:"TaskPreview",type:"qjson"}},l={iPaasEndPoint:{name:"IPaaS_Endpoint",type:"constant"}};const u={"":"Custom","Pending-InProgress":"Pending-InProgress","Pending-Approval":"Pending-Approval","Resolved-Completed":"Resolved-Completed",New:"New",Returned:"Returned","Returned-Originator":"Returned-Originator","Returned-Recipient":"Returned-Recipient","Resolved-Cancelled":"Resolved-Cancelled"},m={"":"StatÃ¼ Yok","Pending-InProgress":"Ä°ÅŸlemde","Pending-Approval":"Bekliyor-Onay","Resolved-Completed":"TamamlandÄ±",New:"Yeni",Returned:"Ä°ade","Returned-Originator":"GiriÅŸÃ§iye Ä°ade Edildi","Returned-Recipient":"Ã‡alÄ±ÅŸana Ä°ade Edildi","Resolved-Cancelled":"Ä°ptal Edildi"};class _{static getDescription(e,t){return("tr_TR"==t?m:u)[e]||e||""}}const w=async e=>{const t=e.flow.getWFE();if(!t)throw new Error("start step can only be used for workflow flow environment");const s=t.wfExecutionContext(),{wfEngineOnUs:n,workflowModel:o,appId:c,processId:l,user:u}=s.getWfeOnUs(),m=s.getScopeStore(),{trxQueue:w,taskId:g,dsManager:f}=m,{processInstance:h,flowThreadId:y,jumpToStepId:I,jumpToStepName:S}=n;if(!f)throw d.errors.ctxErr("dsManager");if(h){const a=await async function(e,t,a,s,r,n){if(r)switch(n){case"end":return{type:"changeStep",jumpToStepId:r,inputName:"terminate"};case"humantask":return{type:"changeStep",jumpToStepId:r,inputName:"_"};default:new Error("The jump action is restricted to boxes end and humantask.")}if(a){const s=await e.Get("WFE_Task",{processInstanceId:t,taskId:a});if(!s)throw new Error(`Task Could not be found taskId: ${a} for PIID: ${t}.`);return{type:"task",task:s}}if(s){const a=await e.Get("WFE_ThreadState",{processInstanceId:t,flowThreadId:s});if(!a)throw new Error(`Thread Could not be found threadId: ${s} for PIID: ${t}.`);return{type:"thread",thread:a}}throw new Error(`No taskId found in execution context: ${t}`)}(f,h.processInstanceId,g,y,I,S);switch(a.type){case"task":return void e.flow.jump({ID:a.task.stepId,inputName:a.task.stepInputName,flowThreadId:a.task.flowThreadId});case"thread":const{action:s,stepId:d,inputName:c,flowThreadId:p,ongoing:_}=a.thread;n.lastAction=s,await async function(e,t,a,s){const n="threadRetried",o=i.getDescription(n,"tr_TR"),d=Date.now();e.lastUpdate=r.toDefaultTimeStampString(new Date(d)),e.lastUpdateUser=t,e.lastUpdateDescriptionCode=n,e.lastUpdateDescription=o,await a.Update("WFE_ProcessInst",{processInstanceId:e.processInstanceId},{updatedAt:d,lastUpdateUser:e.lastUpdateUser,lastUpdateDescriptionCode:e.lastUpdateDescriptionCode,lastUpdateDescription:e.lastUpdateDescription},{trxQueue:s})}(h,u,f,w),function(e,t){var a;e.user=t.user;const s=(null===(a=e.workflowIncomingRequest)||void 0===a?void 0:a.headers)||{};s.additionalHeaders=t.additionalHeaders,e.workflowIncomingRequest={body:{additionalInfo:t.additionalInfo},headers:s}}(m,_);const g=o.steps[d];if(!g)throw new Error(`can not retry thread stepId: ${d} not found on process: ${l}`);return await t.events.threadRetried({ID:d,label:g.P.label}),void e.flow.jump({ID:d,inputName:c,flowThreadId:p});case"changeStep":return void e.flow.jump({ID:a.jumpToStepId,inputName:a.inputName})}}else{const s=e.props.actions.find(e=>"start"==e.actionType);if(!s)throw new Error("start step is missing start action");const r=await t.authz.canUserStartProcess(u,s);if("success"!=r.type)return void e.flow.cancel(new p({message:r.message,statusCode:401,code:r.code,category:"error",type:"business"}));const d=Date.now(),g=m.processInstanceId=a.createSecureUID()+"-"+l,{envManager:h}=m,y=await async function(e,t,a){var s;const r=(null===(s=e.businessKeyGenerationFunction)||void 0===s?void 0:s.id)?await t.system.generateBusinessKeyWFE():a.businessKey;if(!r)throw new p({message:`Business Key Required : PID${a.processId}`,code:"WFE-201",category:"error",type:"technical"});return r}(o,t,m),I=t.system.getParam("initiatorUserId");let S=u;if(I){const e=await t.system.resolveUser(I);if(!e)throw new Error(`User could not be resolved for initiatorUserId: ${I}`);S=e}const{processInstance:D,dataInstance:k,dbProcess:T}=await(async()=>{const a=await t.system.createDataInstance(),s=h.getEnvValue("fmClusterId"),r="start",n={businessKey:y,name:o.name,label:o._name,processId:l,startDate:d,updatedAt:d,processInstanceId:g,appId:c,clusterId:s,initiatorUser:S,version:"WFE_OnUS_NONE",lastUpdateUser:u,status:e.props.procesStatus,statusDescription:_.getDescription(e.props.procesStatus,"tr_TR"),lastUpdateDescriptionCode:r,lastUpdateDescription:i.getDescription(r,"tr_TR"),wfInput:e.msg.input,dataInstance:a,currentUnit:void 0,initiatorUnit:S.unit,systemStatus:"alive"};if(o.sla&&o.sla.selectedSlaModelId){const e=await t.system.createSLA(o.sla.selectedSlaModelId);n.sla=e.sla,n.priority=e.priority}await f.Insert("WFE_ProcessInst",n,{trxQueue:w});const p=await t.converters.convertToIProcessInstAndIDataInst(n);return{processInstance:p.processInstance,dataInstance:p.dataInstance,dbProcess:n}})();n.processInstance=D,n.dataInstance=k,n.lastAction={actionType:s.actionType,customType:s.customType};const U={ID:e.entryInfo.stepID,label:e.props.label,name:"start",action:s};await t.events.processCreated(U,D,k,T,o.sla),e.flow.next()}}})(),__webpack_exports__})());